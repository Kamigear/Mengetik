<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tantangan Mengetik Indonesia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            touch-action: manipulation;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: fixed; /* Mencegah seluruh body ter-scroll */
        }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .char { display: inline; border-bottom: 2px solid transparent; transition: all 0.05s; }
        .char.current {
            background-color: #334155;
            border-bottom: 2px solid #38bdf8;
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { border-bottom-color: transparent; } }
        .char.correct { color: #4ade80; }
        .char.incorrect { color: #f87171; background-color: rgba(248, 113, 113, 0.2); }
        
        #hidden-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            opacity: 0;
            z-index: -1;
        }

        #game-container {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        #game-container::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="flex flex-col p-4">

    <div class="flex-1 flex flex-col max-w-4xl w-full mx-auto overflow-hidden">
        <!-- Stats Section -->
        <div class="flex justify-between items-center mb-4 bg-slate-800/50 p-4 rounded-2xl border border-slate-700 shrink-0">
            <div class="text-center flex-1">
                <p class="text-[10px] uppercase tracking-widest text-slate-400">WPM</p>
                <p id="wpm" class="text-2xl font-bold text-sky-400">0</p>
            </div>
            <div class="text-center flex-1 border-x border-slate-700">
                <p class="text-[10px] uppercase tracking-widest text-slate-400">Akurasi</p>
                <p id="accuracy" class="text-2xl font-bold text-emerald-400">0%</p>
            </div>
            <div class="text-center flex-1">
                <p class="text-[10px] uppercase tracking-widest text-slate-400">Waktu</p>
                <p id="timer" class="text-2xl font-bold text-amber-400">60s</p>
            </div>
        </div>

        <!-- Display Area -->
        <div id="game-container" class="relative flex-1 bg-slate-800 rounded-3xl p-6 border border-slate-700 mb-4 overflow-y-auto shadow-2xl">
            <div id="text-display" class="mono text-2xl md:text-3xl leading-relaxed text-slate-400 select-none break-words text-left pb-20">
                Klik tombol mulai untuk menguji kecepatan jari Anda.
            </div>
            
            <input type="text" id="hidden-input" autocomplete="off" autocapitalize="off" spellcheck="false" inputmode="text">

            <div id="start-overlay" class="absolute inset-0 bg-slate-800/98 rounded-3xl flex flex-col items-center justify-center z-10 text-center p-6">
                <h1 class="text-3xl font-black text-sky-400 mb-2">KetikCepat.id</h1>
                <p class="text-slate-400 text-sm mb-8 italic">Tekan mulai untuk memunculkan keyboard sistem.</p>
                <button onclick="startGame()" class="bg-sky-500 hover:bg-sky-400 text-white px-10 py-4 rounded-2xl font-bold text-xl transition-all shadow-lg shadow-sky-500/20 active:scale-95">
                    Mulai Main
                </button>
                <p class="mt-6 text-xs text-slate-500 font-medium">Skor Tertinggi: <span id="highscore" class="font-bold text-sky-400">0</span> WPM</p>
            </div>
        </div>
    </div>

    <!-- Modal Hasil -->
    <div id="result-modal" class="fixed inset-0 bg-black/95 backdrop-blur-md hidden items-center justify-center z-50 p-6">
        <div class="bg-slate-800 border border-slate-700 p-8 rounded-3xl max-w-sm w-full text-center">
            <h2 class="text-2xl font-bold mb-1">Hasil Pertandingan</h2>
            <div id="new-record-tag" class="hidden inline-block bg-amber-500 text-black text-[10px] font-black px-2 py-0.5 rounded mb-4 italic uppercase">Rekor Baru!</div>
            
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-slate-900/50 p-4 rounded-xl">
                    <p class="text-xs text-slate-400 uppercase tracking-tighter">Kecepatan</p>
                    <p class="text-3xl font-bold text-sky-400"><span id="final-wpm">0</span></p>
                    <p class="text-[10px] text-slate-500 uppercase font-bold">WPM</p>
                </div>
                <div class="bg-slate-900/50 p-4 rounded-xl">
                    <p class="text-xs text-slate-400 uppercase tracking-tighter">Akurasi</p>
                    <p class="text-3xl font-bold text-emerald-400"><span id="final-accuracy">0</span>%</p>
                </div>
            </div>

            <button onclick="resetGame()" class="w-full bg-sky-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-sky-500/20 active:scale-95 transition-all">
                Coba Lagi
            </button>
        </div>
    </div>

    <script>
        const kataIndonesia = [
            "aku", "kamu", "dia", "mereka", "kita", "makan", "minum", "jalan", "lari", "tidur",
            "belajar", "coding", "kerja", "sekolah", "rumah", "buku", "pintu", "jendela", "langit",
            "bumi", "air", "api", "angin", "panas", "dingin", "sehat", "sakit", "senang", "sedih",
            "cepat", "lambat", "tinggi", "rendah", "besar", "kecil", "baru", "lama", "tua", "muda",
            "pagi", "siang", "sore", "malam", "cinta", "semangat", "sukses", "hebat", "pintar",
            "pahlawan", "bangsa", "merdeka", "negeri", "rakyat", "adil", "makmur", "damai"
        ];

        let currentText = "";
        let timeLeft = 60;
        let isPlaying = false;
        let timerInterval;
        let charIndex = 0;
        let mistakes = 0;
        let highscore = localStorage.getItem('typing_mobile_highscore') || 0;

        const textDisplay = document.getElementById('text-display');
        const hiddenInput = document.getElementById('hidden-input');
        const timerEl = document.getElementById('timer');
        const wpmEl = document.getElementById('wpm');
        const accuracyEl = document.getElementById('accuracy');
        const highscoreEl = document.getElementById('highscore');
        const resultModal = document.getElementById('result-modal');
        const startOverlay = document.getElementById('start-overlay');
        const gameContainer = document.getElementById('game-container');

        highscoreEl.innerText = highscore;

        function generateText() {
            const shuffled = [...kataIndonesia].sort(() => 0.5 - Math.random());
            currentText = shuffled.slice(0, 40).join(" ") + " ";
            textDisplay.innerHTML = "";
            currentText.split("").forEach(char => {
                const span = document.createElement('span');
                span.classList.add('char');
                span.innerText = char;
                textDisplay.appendChild(span);
            });
            updateCursor(false); // No scroll on generate
        }

        function updateCursor(shouldScroll = true) {
            const spans = textDisplay.querySelectorAll('span');
            spans.forEach(s => s.classList.remove('current'));
            if (spans[charIndex]) {
                const target = spans[charIndex];
                target.classList.add('current');
                
                if (shouldScroll) {
                    // Gunakan nearest agar tidak meloncat ke tengah layar jika sudah terlihat
                    target.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        function startGame() {
            if (isPlaying) return;
            isPlaying = true;
            charIndex = 0;
            mistakes = 0;
            timeLeft = 60;
            generateText();
            startOverlay.classList.add('hidden');
            
            hiddenInput.value = "";
            hiddenInput.focus();

            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            if (timeLeft > 0) {
                timeLeft--;
                timerEl.innerText = timeLeft + "s";
                calculateStats();
            } else {
                endGame();
            }
        }

        function calculateStats() {
            const timeElapsed = 60 - timeLeft;
            if (timeElapsed <= 0) return { wpm: 0, accuracy: 0 };
            const correctChars = charIndex - mistakes;
            const wpm = Math.max(0, Math.round((correctChars / 5) / (timeElapsed / 60)));
            const accuracy = charIndex > 0 ? Math.round(((charIndex - mistakes) / charIndex) * 100) : 0;
            wpmEl.innerText = wpm;
            accuracyEl.innerText = accuracy + "%";
            return { wpm, accuracy };
        }

        hiddenInput.addEventListener('input', (e) => {
            if (!isPlaying) return;
            
            const val = hiddenInput.value;
            // Jika input kosong (misal backspace sampai habis)
            if (val.length === 0 && charIndex > 0) {
                handleBackspace();
                return;
            }

            const key = val[val.length - 1]; 
            processKey(key);
            
            // Reset input value secara berkala agar tidak terlalu panjang
            if (val.length > 10) {
                hiddenInput.value = val.substring(val.length - 1);
            }
        });

        // Dukungan fisik/sistem untuk backspace
        hiddenInput.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace') {
                handleBackspace();
            }
        });

        function processKey(key) {
            const spans = textDisplay.querySelectorAll('span');
            if (charIndex < currentText.length) {
                if (key === currentText[charIndex]) {
                    spans[charIndex].classList.add('correct');
                    spans[charIndex].classList.remove('incorrect');
                } else {
                    spans[charIndex].classList.add('incorrect');
                    spans[charIndex].classList.remove('correct');
                    mistakes++;
                }
                charIndex++;
                
                if (charIndex === currentText.length) {
                    generateText();
                    charIndex = 0;
                }
                updateCursor(true);
            }
        }

        function handleBackspace() {
            if (charIndex > 0) {
                charIndex--;
                const spans = textDisplay.querySelectorAll('span');
                spans[charIndex].classList.remove('correct', 'incorrect');
                updateCursor(true);
            }
        }

        function endGame() {
            clearInterval(timerInterval);
            isPlaying = false;
            hiddenInput.blur();
            const stats = calculateStats();
            
            document.getElementById('final-wpm').innerText = stats.wpm;
            document.getElementById('final-accuracy').innerText = stats.accuracy;

            if (stats.wpm > highscore) {
                highscore = stats.wpm;
                localStorage.setItem('typing_mobile_highscore', highscore);
                highscoreEl.innerText = highscore;
                document.getElementById('new-record-tag').classList.remove('hidden');
            } else {
                document.getElementById('new-record-tag').classList.add('hidden');
            }

            resultModal.classList.remove('hidden');
            resultModal.classList.add('flex');
        }

        function resetGame() {
            resultModal.classList.add('hidden');
            resultModal.classList.remove('flex');
            startOverlay.classList.remove('hidden');
            wpmEl.innerText = "0";
            accuracyEl.innerText = "0%";
            timerEl.innerText = "60s";
            textDisplay.innerHTML = "Klik tombol mulai untuk menguji kecepatan jari Anda.";
        }

        // Mencegah scroll default browser saat fokus input
        gameContainer.addEventListener('click', (e) => {
            if (isPlaying) {
                hiddenInput.focus();
                e.preventDefault();
            }
        });

        // Handle viewport resize (keyboard muncul) tanpa scroll body
        window.visualViewport.addEventListener('resize', () => {
            if (isPlaying) {
                window.scrollTo(0, 0); // Paksa body tetap di atas
                updateCursor(true);
            }
        });
    </script>
</body>
</html>
